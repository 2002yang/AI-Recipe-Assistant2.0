# åå°æ–‡ä»¶ç»“æ„è¯¦è§£

## ğŸ“ å®Œæ•´æ–‡ä»¶æ ‘çŠ¶å›¾

```
backend/
â”‚
â”œâ”€â”€ app/
â”‚   â”‚
â”‚   â”œâ”€â”€ __init__.py                    ã€ç©ºæ–‡ä»¶ï¼ŒPythonåŒ…æ ‡è®°ã€‘
â”‚   â”‚
â”‚   â”œâ”€â”€ main.py                        ã€âœ… æ­£åœ¨ä½¿ç”¨ - åº”ç”¨å…¥å£ã€‘
â”‚   â”‚   â””â”€â”€ ä½œç”¨ï¼šFastAPIåº”ç”¨åˆå§‹åŒ–ï¼Œæ³¨å†Œè·¯ç”±
â”‚   â”‚
â”‚   â”œâ”€â”€ models/                        ã€âœ… æ­£åœ¨ä½¿ç”¨ - æ•°æ®æ¨¡å‹ã€‘
â”‚   â”‚   â”œâ”€â”€ __init__.py                ã€ç©ºæ–‡ä»¶ã€‘
â”‚   â”‚   â”œâ”€â”€ chat.py                    ã€âœ… ä½¿ç”¨ - å¯¹è¯æ•°æ®æ¨¡å‹ã€‘
â”‚   â”‚   â”‚   â””â”€â”€ ChatRequest, ChatResponse, ChatMessage
â”‚   â”‚   â””â”€â”€ recipe.py                  ã€âœ… ä½¿ç”¨ - èœè°±æ•°æ®æ¨¡å‹ã€‘
â”‚   â”‚       â””â”€â”€ Recipe, Ingredient, Nutrition
â”‚   â”‚
â”‚   â”œâ”€â”€ routers/                       ã€âœ… æ­£åœ¨ä½¿ç”¨ - APIè·¯ç”±ã€‘
â”‚   â”‚   â”œâ”€â”€ __init__.py                ã€ç©ºæ–‡ä»¶ã€‘
â”‚   â”‚   â”œâ”€â”€ chat.py                    ã€âœ… ä½¿ç”¨ - å¯¹è¯APIã€‘
â”‚   â”‚   â”‚   â”œâ”€â”€ POST /api/chat/message ã€æ ¸å¿ƒæ¥å£ã€‘
â”‚   â”‚   â”‚   â”œâ”€â”€ POST /api/chat/new
â”‚   â”‚   â”‚   â””â”€â”€ GET /api/chat/history/{id}
â”‚   â”‚   â”œâ”€â”€ recipes.py                 ã€âœ… ä½¿ç”¨ - èœè°±APIã€‘
â”‚   â”‚   â”‚   â”œâ”€â”€ GET /api/recipes/list
â”‚   â”‚   â”‚   â”œâ”€â”€ GET /api/recipes/{id}
â”‚   â”‚   â”‚   â””â”€â”€ POST /api/recipes/search
â”‚   â”‚   â””â”€â”€ nutrition.py               ã€âœ… ä½¿ç”¨ - è¥å…»APIã€‘
â”‚   â”‚       â”œâ”€â”€ GET /api/nutrition/recipe/{id}
â”‚   â”‚       â””â”€â”€ GET /api/nutrition/recipe/{id}/diet/{type}
â”‚   â”‚
â”‚   â”œâ”€â”€ services/                      ã€âœ… æ­£åœ¨ä½¿ç”¨ - ä¸šåŠ¡é€»è¾‘ã€‘
â”‚   â”‚   â”œâ”€â”€ __init__.py                ã€ç©ºæ–‡ä»¶ã€‘
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸŸ¢ åŸºç¡€ç‰ˆæœ¬ï¼ˆæ­£åœ¨ä½¿ç”¨ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ nlp_service.py         ã€âœ… ä½¿ç”¨ - å½“å‰NLPæœåŠ¡ã€‘
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ parse_user_intent()     ã€DeepSeekæ„å›¾è§£æã€‘
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ generate_response()     ã€ç”ŸæˆAIå›å¤ã€‘
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ è¢« chat.py è°ƒç”¨
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ recipe_matcher.py      ã€âœ… ä½¿ç”¨ - èœè°±åŒ¹é…ç®—æ³•ã€‘
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ search_by_ingredients() ã€æ ¸å¿ƒåŒ¹é…ç®—æ³•ã€‘
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ _check_restrictions()   ã€é¥®é£Ÿé™åˆ¶è¿‡æ»¤ã€‘
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ conversation.py        ã€âœ… ä½¿ç”¨ - å¯¹è¯ç®¡ç†ã€‘
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ create_conversation()
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ add_message()
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ get_recent_context()
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â””â”€â”€ nutrition_calc.py      ã€âœ… ä½¿ç”¨ - è¥å…»è®¡ç®—ã€‘
â”‚   â”‚   â”‚       â”œâ”€â”€ calculate_daily_needs()
â”‚   â”‚   â”‚       â””â”€â”€ analyze_meal_nutrition()
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ ğŸ”´ LangChainå‡çº§ï¼ˆæš‚æœªä½¿ç”¨ï¼‰
â”‚   â”‚       â”œâ”€â”€ langchain_nlp.py       ã€âŒ æœªä½¿ç”¨ - LangChainç‰ˆæœ¬NLPã€‘
â”‚   â”‚       â”‚   â”œâ”€â”€ parse_user_intent()    ã€Chainç‰ˆæ„å›¾è§£æã€‘
â”‚   â”‚       â”‚   â”œâ”€â”€ search_recipes_with_rag() ã€RAGæœç´¢ã€‘
â”‚   â”‚       â”‚   â””â”€â”€ generate_response()    ã€Chainç‰ˆå›å¤ç”Ÿæˆã€‘
â”‚   â”‚       â”‚
â”‚   â”‚       â”œâ”€â”€ embedding_service.py   ã€âŒ æœªä½¿ç”¨ - æ–‡æœ¬å‘é‡åŒ–ã€‘
â”‚   â”‚       â”‚   â””â”€â”€ embed_text()           ã€ç”Ÿæˆ384ç»´å‘é‡ã€‘
â”‚   â”‚       â”‚
â”‚   â”‚       â”œâ”€â”€ vector_store.py        ã€âŒ æœªä½¿ç”¨ - ChromaDBå‘é‡åº“ã€‘
â”‚   â”‚       â”‚   â”œâ”€â”€ add_recipes()          ã€å¯¼å…¥èœè°±å‘é‡ã€‘
â”‚   â”‚       â”‚   â””â”€â”€ search()               ã€è¯­ä¹‰æœç´¢ã€‘
â”‚   â”‚       â”‚
â”‚   â”‚       â”œâ”€â”€ enhanced_conversation.py ã€âŒ æœªä½¿ç”¨ - LangChain Memoryã€‘
â”‚   â”‚       â”‚   â””â”€â”€ å¸¦LangChain Memoryçš„å¯¹è¯ç®¡ç†
â”‚   â”‚       â”‚
â”‚   â”‚       â””â”€â”€ init_vector_db.py      ã€âŒ æœªä½¿ç”¨ - å‘é‡åº“åˆå§‹åŒ–è„šæœ¬ã€‘
â”‚   â”‚           â””â”€â”€ è¿è¡Œä¸€æ¬¡ï¼Œå¯¼å…¥50é“èœè°±åˆ°ChromaDB
â”‚   â”‚
â”‚   â””â”€â”€ data/                          ã€âœ… æ•°æ®æ–‡ä»¶ã€‘
â”‚       â””â”€â”€ recipes.json               ã€50é“èœè°±æ•°æ®ã€‘
â”‚
â”œâ”€â”€ venv/                              ã€Pythonè™šæ‹Ÿç¯å¢ƒã€‘
â”œâ”€â”€ requirements.txt                   ã€Pythonä¾èµ–åˆ—è¡¨ã€‘
â””â”€â”€ server.log                         ã€è¿è¡Œæ—¥å¿—ã€‘
```

---

## ğŸ¯ æ–‡ä»¶ä½¿ç”¨æƒ…å†µä¸€è§ˆè¡¨

### âœ… æ­£åœ¨ä½¿ç”¨çš„æ–‡ä»¶ï¼ˆåŸºç¡€ç‰ˆæœ¬ï¼‰

| æ–‡ä»¶ | è¢«è°è°ƒç”¨ | ä½œç”¨ |
|------|----------|------|
| `main.py` | Uvicornå¯åŠ¨ | FastAPIåº”ç”¨å…¥å£ |
| `chat.py` | main.py | å¯¹è¯APIè·¯ç”± |
| `recipes.py` | main.py | èœè°±APIè·¯ç”± |
| `nutrition.py` | main.py | è¥å…»APIè·¯ç”± |
| `nlp_service.py` | chat.py | DeepSeek AIæœåŠ¡ |
| `recipe_matcher.py` | chat.py | èœè°±åŒ¹é…ç®—æ³• |
| `conversation.py` | chat.py | å¯¹è¯ä¸Šä¸‹æ–‡ç®¡ç† |
| `nutrition_calc.py` | chat.py | è¥å…»è®¡ç®— |
| `chat.py(models)` | chat.py(router) | æ•°æ®æ¨¡å‹å®šä¹‰ |
| `recipe.py(models)` | recipe_matcher.py | æ•°æ®æ¨¡å‹å®šä¹‰ |
| `recipes.json` | recipe_matcher.py | 50é“èœè°±æ•°æ® |

### âŒ é¢„ç•™æœªä½¿ç”¨çš„æ–‡ä»¶ï¼ˆLangChain+RAGå‡çº§ï¼‰

| æ–‡ä»¶ | è®¡åˆ’ç”¨é€” | çŠ¶æ€ |
|------|----------|------|
| `langchain_nlp.py` | æ›¿æ¢ nlp_service.py | ğŸ”´ æœªå¯ç”¨ |
| `embedding_service.py` | æ–‡æœ¬å‘é‡åŒ– | ğŸ”´ æœªå¯ç”¨ |
| `vector_store.py` | ChromaDBè¯­ä¹‰æœç´¢ | ğŸ”´ æœªå¯ç”¨ |
| `enhanced_conversation.py` | æ›¿æ¢ conversation.py | ğŸ”´ æœªå¯ç”¨ |
| `init_vector_db.py` | åˆå§‹åŒ–å‘é‡åº“ | ğŸ”´ æœªè¿è¡Œ |

---

## ğŸ” è¯¦ç»†è§£é‡Š

### âœ… æ­£åœ¨ä½¿ç”¨çš„ä»£ç æµç¨‹

```
main.py
    â†“ å¯¼å…¥å¹¶æ³¨å†Œè·¯ç”±
chat.py (è·¯ç”±)
    â†“ è°ƒç”¨
â”œâ”€ nlp_service.py        ã€æ„å›¾è§£æ + å›å¤ç”Ÿæˆã€‘
â”œâ”€ recipe_matcher.py     ã€èœè°±åŒ¹é…ç®—æ³•ã€‘
â”œâ”€ conversation.py       ã€å¯¹è¯å†å²ç®¡ç†ã€‘
â””â”€ nutrition_calc.py     ã€è¥å…»è®¡ç®—ã€‘
```

**ç¤ºä¾‹è°ƒç”¨é“¾**ï¼š
```python
# chat.py ç¬¬4-6è¡Œ
from app.services.nlp_service import nlp_service              # âœ… ä½¿ç”¨
from app.services.recipe_matcher import recipe_service        # âœ… ä½¿ç”¨
from app.services.conversation import conversation_manager    # âœ… ä½¿ç”¨

# ç¬¬27è¡Œï¼šæ„å›¾è§£æ
parsed_intent = await nlp_service.parse_user_intent(request.message)

# ç¬¬50è¡Œï¼šèœè°±åŒ¹é…
matches = recipe_service.search_by_ingredients(ingredients, restrictions, top_k=3)

# ç¬¬99è¡Œï¼šç”Ÿæˆå›å¤
ai_response = await nlp_service.generate_response(user_message, context, recipes)
```

### âŒ é¢„ç•™çš„å‡çº§ä»£ç 

```
langchain_nlp.py ç­‰æ–‡ä»¶
    â†“
âŒ æ²¡æœ‰è¢«ä»»ä½•æ–‡ä»¶å¯¼å…¥
âŒ æ²¡æœ‰è¿è¡Œ
âŒ åªæ˜¯ä»£ç å‡†å¤‡å¥½
```

**ä¸ºä»€ä¹ˆæ²¡ä½¿ç”¨ï¼Ÿ**

1. **ç¨³å®šæ€§ä¼˜å…ˆ**ï¼šåŸºç¡€ç‰ˆæœ¬ï¼ˆ`nlp_service.py`ï¼‰è¿è¡Œç¨³å®š
2. **ä¾èµ–é—®é¢˜**ï¼šLangChain ç›¸å…³ä¾èµ–è¾ƒå¤§ï¼Œå®‰è£…æ—¶é—´é•¿
3. **å‘é‡åº“**ï¼šéœ€è¦é¢å¤–è¿è¡Œåˆå§‹åŒ–è„šæœ¬ç”Ÿæˆå‘é‡
4. **æ¸è¿›å‡çº§**ï¼šåŸºç¡€ç‰ˆæœ¬å¤Ÿç”¨ï¼ŒLangChain ç‰ˆæœ¬ä½œä¸ºæœªæ¥æ‰©å±•

---

## ğŸš€ å¦‚ä½•å¯ç”¨ LangChain ç‰ˆæœ¬ï¼Ÿ

å¦‚æœä½ æƒ³ä½¿ç”¨ `langchain_nlp.py` ç­‰æ–°åŠŸèƒ½ï¼š

### æ­¥éª¤1ï¼šä¿®æ”¹ chat.py
```python
# ç¬¬4-6è¡Œ æ”¹ä¸ºï¼š
from app.services.langchain_nlp import langchain_nlp_service  # æ–°
from app.services.enhanced_conversation import enhanced_conversation_manager  # æ–°

# ç„¶åä¿®æ”¹åç»­æ‰€æœ‰è°ƒç”¨
parsed_intent = await langchain_nlp_service.parse_user_intent(...)
```

### æ­¥éª¤2ï¼šåˆå§‹åŒ–å‘é‡åº“
```bash
cd backend
python -m app.services.init_vector_db
```

### æ­¥éª¤3ï¼šé‡å¯æœåŠ¡
```bash
python -m uvicorn app.main:app --reload --port 8080
```

---

## ğŸ“Š æ€»ç»“

```
æ€»æ–‡ä»¶æ•°ï¼š21ä¸ªPythonæ–‡ä»¶
â”œâ”€â”€ æ­£åœ¨ä½¿ç”¨ï¼š12ä¸ªï¼ˆ57%ï¼‰
â”‚   â”œâ”€â”€ æ ¸å¿ƒï¼šmain.py + 3ä¸ªrouter + 4ä¸ªservice + 2ä¸ªmodel
â”‚   â””â”€â”€ è¾…åŠ©ï¼š3ä¸ª__init__.py
â”œâ”€â”€ é¢„ç•™æœªç”¨ï¼š5ä¸ªï¼ˆ24%ï¼‰
â”‚   â””â”€â”€ LangChain + RAG å‡çº§ä»£ç 
â””â”€â”€ å…¶ä»–ï¼šæ•°æ®æ–‡ä»¶ + æ—¥å¿—

ğŸ’¡ å»ºè®®ï¼š
- å½“å‰è¿è¡Œçš„æ˜¯ç¨³å®šçš„åŸºç¡€ç‰ˆæœ¬
- LangChainç‰ˆæœ¬ä»£ç å·²å†™å¥½ï¼Œå¯æŒ‰éœ€å¯ç”¨
- åˆ é™¤æœªä½¿ç”¨æ–‡ä»¶ä¸ä¼šå½±å“å½“å‰è¿è¡Œ
```

---

**å…³é”®ç»“è®º**ï¼š`langchain_nlp.py` ç¡®å®æ²¡æœ‰è¢«ä½¿ç”¨ï¼Œå®ƒæ˜¯ä¸º**æœªæ¥å‡çº§**å‡†å¤‡çš„ï¼å½“å‰ä½¿ç”¨çš„æ˜¯ `nlp_service.py` ğŸ¯