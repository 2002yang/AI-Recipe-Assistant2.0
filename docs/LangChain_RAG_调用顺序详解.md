# LangChain ä¸ RAG å®Œæ•´è°ƒç”¨æµç¨‹è¯¦è§£

## ğŸ¯ æ ¸å¿ƒé—®é¢˜ï¼šè°å…ˆå¤„ç†ï¼Ÿ

**ç­”æ¡ˆï¼šLangChain å…ˆå¤„ç†ï¼ŒRAG åå¤„ç†**

```
ç”¨æˆ·è¾“å…¥
    â†“
ã€ç¬¬ä¸€æ­¥ã€‘LangChain æ„å›¾è§£æï¼ˆç†è§£ç”¨æˆ·æƒ³è¦ä»€ä¹ˆï¼‰
    â†“
ã€ç¬¬äºŒæ­¥ã€‘RAG å‘é‡æ£€ç´¢ï¼ˆæ ¹æ®ç†è§£å»æŸ¥æ‰¾ç›¸å…³å†…å®¹ï¼‰
    â†“
ã€ç¬¬ä¸‰æ­¥ã€‘LangChain å›å¤ç”Ÿæˆï¼ˆåŸºäºæ£€ç´¢ç»“æœç”Ÿæˆå›ç­”ï¼‰
```

LangChain æ˜¯**æŒ‡æŒ¥å®˜**ï¼ŒRAG æ˜¯**æ‰§è¡Œè€…**ã€‚

---

## ğŸ“Š å®Œæ•´è°ƒç”¨æµç¨‹å›¾

### åœºæ™¯ï¼šç”¨æˆ·è¾“å…¥ "æˆ‘æƒ³åƒæ¸…æ·¡çš„è±†è…èœ"

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         å‰ç«¯å±‚                                   â”‚
â”‚  ChatInterface.tsx: ç”¨æˆ·è¾“å…¥                                     â”‚
â”‚  "æˆ‘æƒ³åƒæ¸…æ·¡çš„è±†è…èœ"                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ axios.post('/api/chat/message')
                         â”‚ {message: "æˆ‘æƒ³åƒæ¸…æ·¡çš„è±†è…èœ"}
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      åç«¯è·¯ç”±å±‚                                  â”‚
â”‚  chat.py: @router.post("/message")                              â”‚
â”‚                                                                 â”‚
â”‚  async def chat_message(request: ChatRequest):                  â”‚
â”‚      # ç¬¬1æ­¥ï¼šè·å–å¯¹è¯ä¸Šä¸‹æ–‡                                     â”‚
â”‚      conversation_id = request.conversation_id                  â”‚
â”‚      context = conversation_manager.get_recent_context()        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ await langchain_nlp_service.parse_user_intent()
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚           ã€ç¬¬ä¸€é˜¶æ®µã€‘LangChain æ„å›¾è§£æ                 â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚  ä½ç½®: langchain_nlp.py - parse_user_intent()          â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚  Intent Chain: PromptTemplate | LLM | JsonOutputParser â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚  è¾“å…¥: "æˆ‘æƒ³åƒæ¸…æ·¡çš„è±†è…èœ"                              â”‚   â”‚
â”‚  â”‚       â†“                                                â”‚   â”‚
â”‚  â”‚  PromptTemplate:                                       â”‚   â”‚
â”‚  â”‚    "åˆ†æç”¨æˆ·è¾“å…¥ï¼Œæå–ä»¥ä¸‹ä¿¡æ¯ï¼š                          â”‚   â”‚
â”‚  â”‚     intent: ç”¨æˆ·æ„å›¾                                     â”‚   â”‚
â”‚  â”‚     ingredients: é£Ÿæåˆ—è¡¨                                â”‚   â”‚
â”‚  â”‚     restrictions: é¥®é£Ÿé™åˆ¶                               â”‚   â”‚
â”‚  â”‚     preferences: å£å‘³åå¥½                                â”‚   â”‚
â”‚  â”‚     target_dish: ç›®æ ‡èœå“"                               â”‚   â”‚
â”‚  â”‚       â†“                                                â”‚   â”‚
â”‚  â”‚  LLM (DeepSeek API) è°ƒç”¨                                 â”‚   â”‚
â”‚  â”‚       â†“                                                â”‚   â”‚
â”‚  â”‚  JsonOutputParser è§£æ                                   â”‚   â”‚
â”‚  â”‚       â†“                                                â”‚   â”‚
â”‚  â”‚  è¾“å‡º: {                                                â”‚   â”‚
â”‚  â”‚    "intent": "recommend_by_ingredients",                â”‚   â”‚
â”‚  â”‚    "ingredients": [],                                   â”‚   â”‚
â”‚  â”‚    "restrictions": [],                                  â”‚   â”‚
â”‚  â”‚    "preferences": ["æ¸…æ·¡"],                             â”‚   â”‚
â”‚  â”‚    "target_dish": "è±†è…"                                â”‚   â”‚
â”‚  â”‚  }                                                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ await langchain_nlp_service.search_recipes_with_rag()
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              ã€ç¬¬äºŒé˜¶æ®µã€‘RAG å‘é‡æ£€ç´¢                    â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚  ä½ç½®: langchain_nlp.py - search_recipes_with_rag()    â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚  è¾“å…¥:                                                  â”‚   â”‚
â”‚  â”‚    query: "æˆ‘æƒ³åƒæ¸…æ·¡çš„è±†è…èœ"                           â”‚   â”‚
â”‚  â”‚    ingredients: []                                      â”‚   â”‚
â”‚  â”‚    restrictions: []                                     â”‚   â”‚
â”‚  â”‚    top_k: 5                                             â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚ Step 1: æ„å»ºè¯­ä¹‰æŸ¥è¯¢                             â”‚   â”‚   â”‚
â”‚  â”‚  â”‚                                                 â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ if ingredients:                                 â”‚   â”‚   â”‚
â”‚  â”‚  â”‚   search_query = "åŒ…å«...çš„èœ"                   â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ else:                                           â”‚   â”‚   â”‚
â”‚  â”‚  â”‚   search_query = ç”¨æˆ·åŸå§‹è¾“å…¥                   â”‚   â”‚   â”‚
â”‚  â”‚  â”‚                                                 â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ ç»“æœ: search_query = "æˆ‘æƒ³åƒæ¸…æ·¡çš„è±†è…èœ"        â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â”‚                     â”‚                                     â”‚   â”‚
â”‚  â”‚                     â”‚ vector_store.search()              â”‚   â”‚
â”‚  â”‚                     â–¼                                     â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚ Step 2: æ–‡æœ¬å‘é‡åŒ– (Embedding)                   â”‚   â”‚   â”‚
â”‚  â”‚  â”‚                                                 â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ ä½ç½®: embedding_service.py - embed_text()      â”‚   â”‚   â”‚
â”‚  â”‚  â”‚                                                 â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ è¾“å…¥: "æˆ‘æƒ³åƒæ¸…æ·¡çš„è±†è…èœ"                       â”‚   â”‚   â”‚
â”‚  â”‚  â”‚       â†“                                        â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ SentenceTransformer.encode()                   â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ æ¨¡å‹: paraphrase-multilingual-MiniLM-L12-v2    â”‚   â”‚   â”‚
â”‚  â”‚  â”‚       â†“                                        â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ è¾“å‡º: [0.23, -0.56, 0.89, ...] (384ç»´å‘é‡)      â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â”‚                     â”‚                                     â”‚   â”‚
â”‚  â”‚                     â–¼                                     â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚ Step 3: å‘é‡æ•°æ®åº“æœç´¢ (Vector Search)           â”‚   â”‚   â”‚
â”‚  â”‚  â”‚                                                 â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ ä½ç½®: vector_store.py - search()               â”‚   â”‚   â”‚
â”‚  â”‚  â”‚                                                 â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ ChromaDB.collection.query(                      â”‚   â”‚   â”‚
â”‚  â”‚  â”‚   query_embeddings=[å‘é‡],                      â”‚   â”‚   â”‚
â”‚  â”‚  â”‚   n_results=5,                                  â”‚   â”‚   â”‚
â”‚  â”‚  â”‚   include=["metadatas", "distances"]            â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ )                                               â”‚   â”‚   â”‚
â”‚  â”‚  â”‚                                                 â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ å†…éƒ¨ç®—æ³•: HNSW (Hierarchical Navigable          â”‚   â”‚   â”‚
â”‚  â”‚  â”‚          Small World) è¿‘ä¼¼æœ€è¿‘é‚»æœç´¢             â”‚   â”‚   â”‚
â”‚  â”‚  â”‚                                                 â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ æ—¶é—´å¤æ‚åº¦: O(log n) - éå¸¸å¿«ï¼                 â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â”‚                     â”‚                                     â”‚   â”‚
â”‚  â”‚                     â–¼                                     â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚ Step 4: ç›¸ä¼¼åº¦è®¡ç®—ä¸æ’åº                         â”‚   â”‚   â”‚
â”‚  â”‚  â”‚                                                 â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ åŸå§‹è·ç¦»: [0.09, 0.12, 0.15, 0.68, 0.72]       â”‚   â”‚   â”‚
â”‚  â”‚  â”‚                                                 â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ è½¬æ¢ä¸ºç›¸ä¼¼åº¦: similarity = 1 - distance        â”‚   â”‚   â”‚
â”‚  â”‚  â”‚                                                 â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ ç»“æœ: [0.91, 0.88, 0.85, 0.32, 0.28]           â”‚   â”‚   â”‚
â”‚  â”‚  â”‚                                                 â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ åŒ¹é…ç»“æœ:                                       â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ 1. é’èœè±†è…æ±¤    ç›¸ä¼¼åº¦: 0.91 âœ…                â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ 2. å°è‘±æ‹Œè±†è…    ç›¸ä¼¼åº¦: 0.88 âœ…                â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ 3. è’œè“‰è¥¿å…°èŠ±    ç›¸ä¼¼åº¦: 0.85 âœ…                â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ 4. å®¶å¸¸è±†è…      ç›¸ä¼¼åº¦: 0.32                   â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ 5. éº»å©†è±†è…      ç›¸ä¼¼åº¦: 0.28 âŒ (å¤ªæ²¹è…»)        â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â”‚                     â”‚                                     â”‚   â”‚
â”‚  â”‚                     â–¼                                     â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚ Step 5: é¥®é£Ÿé™åˆ¶è¿‡æ»¤                             â”‚   â”‚   â”‚
â”‚  â”‚  â”‚                                                 â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ _check_restrictions(recipe, restrictions)      â”‚   â”‚   â”‚
â”‚  â”‚  â”‚                                                 â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ æ£€æŸ¥: ç´ é£Ÿ? æ— è¾£? ä½ç¢³æ°´?                       â”‚   â”‚   â”‚
â”‚  â”‚  â”‚                                                 â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ éº»å©†è±†è…: å«æœ‰"è¾£"æ ‡ç­¾ â†’ è¿‡æ»¤æ‰ âŒ              â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â”‚                     â”‚                                     â”‚   â”‚
â”‚  â”‚                     â–¼                                     â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚ Step 6: è·å–å®Œæ•´èœè°±ä¿¡æ¯                         â”‚   â”‚   â”‚
â”‚  â”‚  â”‚                                                 â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ recipe_service.get_recipe_by_id(id)            â”‚   â”‚   â”‚
â”‚  â”‚  â”‚                                                 â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ ä» recipes.json åŠ è½½å®Œæ•´èœè°±æ•°æ®               â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ åŒ…æ‹¬: steps, tips, nutrition ç­‰                â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â”‚                     â”‚                                     â”‚   â”‚
â”‚  â”‚  è¾“å‡º:                                              â”‚   â”‚
â”‚  â”‚  [                                                  â”‚   â”‚
â”‚  â”‚    {                                                â”‚   â”‚
â”‚  â”‚      "recipe": <é’èœè±†è…æ±¤ Recipeå¯¹è±¡>,              â”‚   â”‚
â”‚  â”‚      "match_score": 0.91,                           â”‚   â”‚
â”‚  â”‚      "matched_ingredients": [],                     â”‚   â”‚
â”‚  â”‚      "missing_ingredients": [],                     â”‚   â”‚
â”‚  â”‚      "vector_similarity": 0.91                      â”‚   â”‚
â”‚  â”‚    },                                               â”‚   â”‚
â”‚  â”‚    {                                                â”‚   â”‚
â”‚  â”‚      "recipe": <å°è‘±æ‹Œè±†è… Recipeå¯¹è±¡>,              â”‚   â”‚
â”‚  â”‚      "match_score": 0.88,                           â”‚   â”‚
â”‚  â”‚      ...                                            â”‚   â”‚
â”‚  â”‚    },                                               â”‚   â”‚
â”‚  â”‚    ...                                              â”‚   â”‚
â”‚  â”‚  ]                                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ await langchain_nlp_service.generate_response()
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚          ã€ç¬¬ä¸‰é˜¶æ®µã€‘LangChain å›å¤ç”Ÿæˆ                  â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚  ä½ç½®: langchain_nlp.py - generate_response()          â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚  Response Chain: ChatPromptTemplate | LLM | Parser     â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚  è¾“å…¥:                                                  â”‚   â”‚
â”‚  â”‚    user_message: "æˆ‘æƒ³åƒæ¸…æ·¡çš„è±†è…èœ"                    â”‚   â”‚
â”‚  â”‚    history: [ä¹‹å‰å¯¹è¯å†å²]                               â”‚   â”‚
â”‚  â”‚    recipes: [é’èœè±†è…æ±¤, å°è‘±æ‹Œè±†è…, è’œè“‰è¥¿å…°èŠ±]         â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚  Prompt æ„å»º:                                           â”‚   â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                      â”‚   â”‚
â”‚  â”‚  System: ä½ æ˜¯ç¾é£ŸåŠ©æ‰‹...                                â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚  History:                                               â”‚   â”‚
â”‚  â”‚    ç”¨æˆ·: ...                                            â”‚   â”‚
â”‚  â”‚    åŠ©æ‰‹: ...                                            â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚  User: æˆ‘æƒ³åƒæ¸…æ·¡çš„è±†è…èœ                               â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚  ç›¸å…³èœè°±:                                              â”‚   â”‚
â”‚  â”‚    1. é’èœè±†è…æ±¤ - æ¸…æ·¡çˆ½å£ï¼Œä½çƒ­é‡                     â”‚   â”‚
â”‚  â”‚    2. å°è‘±æ‹Œè±†è… - ç®€å•ç¾å‘³                             â”‚   â”‚
â”‚  â”‚    3. è’œè“‰è¥¿å…°èŠ± - è¥å…»ä¸°å¯Œ                             â”‚   â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                      â”‚   â”‚
â”‚  â”‚       â†“                                                â”‚   â”‚
â”‚  â”‚  LLM (DeepSeek API) ç”Ÿæˆå›å¤                            â”‚   â”‚
â”‚  â”‚       â†“                                                â”‚   â”‚
â”‚  â”‚  è¾“å‡º: "ä¸ºæ‚¨æ¨èä»¥ä¸‹æ¸…æ·¡çš„è±†è…èœï¼š                       â”‚   â”‚
â”‚  â”‚          1. é’èœè±†è…æ±¤...                               â”‚   â”‚
â”‚  â”‚          2. å°è‘±æ‹Œè±†è…..."                              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å“åº”ç»„è£…ä¸è¿”å›                                â”‚
â”‚                                                                 â”‚
â”‚  return ChatResponse(                                           â”‚
â”‚      message=ai_response,                                       â”‚
â”‚      conversation_id=conversation_id,                           â”‚
â”‚      suggested_recipes=[...],                                   â”‚
â”‚      detected_ingredients=[],                                   â”‚
â”‚      detected_restrictions=[],                                  â”‚
â”‚      detected_preferences=["æ¸…æ·¡"]                             â”‚
â”‚  )                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ JSON Response
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         å‰ç«¯å±‚                                   â”‚
â”‚                                                                 â”‚
â”‚  App.tsx æ¥æ”¶å“åº”:                                              â”‚
â”‚    - setMessages() æ˜¾ç¤º AI å›å¤                                 â”‚
â”‚    - setCurrentResponse() æ¸²æŸ“ RecipeCard                       â”‚
â”‚                                                                 â”‚
â”‚  RecipeCard.tsx å±•ç¤º:                                           â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚    â”‚ é’èœè±†è…æ±¤              åŒ¹é…åº¦: 91% â”‚                      â”‚
â”‚    â”‚ æ ‡ç­¾: ç´ é£Ÿã€ä½å¡                      â”‚                      â”‚
â”‚    â”‚ æ—¶é—´: 10åˆ†é’Ÿ                          â”‚                      â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” å…³é”®å‡½æ•°è°ƒç”¨é“¾è¯¦è§£

### è°ƒç”¨é“¾ 1ï¼šæ„å›¾è§£æï¼ˆLangChainï¼‰

```python
# è°ƒç”¨å…¥å£
chat.py:
    parsed_intent = await langchain_nlp_service.parse_user_intent(
        "æˆ‘æƒ³åƒæ¸…æ·¡çš„è±†è…èœ"
    )

# å†…éƒ¨è°ƒç”¨
langchain_nlp.py:
    async def parse_user_intent(self, message: str):
        # ä½¿ç”¨ Intent Chain
        intent_chain = (
            PromptTemplate(...)  # æ„å»ºæç¤ºè¯
            | self.llm           # è°ƒç”¨ LLM (DeepSeek)
            | JsonOutputParser() # è§£æ JSON è¾“å‡º
        )
        
        result = await intent_chain.ainvoke({"input": message})
        return result

# DeepSeek API è°ƒç”¨ç»†èŠ‚
POST https://api.deepseek.com/v1/chat/completions
Headers:
  Authorization: Bearer sk-...
Body:
  {
    "model": "deepseek-chat",
    "messages": [
      {
        "role": "system",
        "content": "åˆ†æç”¨æˆ·è¾“å…¥ï¼Œæå–æ„å›¾ã€é£Ÿæã€é™åˆ¶..."
      },
      {
        "role": "user",
        "content": "æˆ‘æƒ³åƒæ¸…æ·¡çš„è±†è…èœ"
      }
    ],
    "temperature": 0.3,
    "max_tokens": 500
  }

# è¿”å›ç»“æœ
{
  "intent": "recommend_by_ingredients",
  "ingredients": [],
  "restrictions": [],
  "preferences": ["æ¸…æ·¡"],
  "target_dish": "è±†è…"
}
```

### è°ƒç”¨é“¾ 2ï¼šå‘é‡æ£€ç´¢ï¼ˆRAGï¼‰

```python
# è°ƒç”¨å…¥å£
chat.py:
    rag_results = await langchain_nlp_service.search_recipes_with_rag(
        query="æˆ‘æƒ³åƒæ¸…æ·¡çš„è±†è…èœ",
        ingredients=[],
        restrictions=[],
        top_k=5
    )

# å†…éƒ¨è°ƒç”¨é“¾
langchain_nlp.py:
    async def search_recipes_with_rag(self, query, ingredients, restrictions, top_k):
        # 1. æ„å»ºæŸ¥è¯¢
        search_query = query  # "æˆ‘æƒ³åƒæ¸…æ·¡çš„è±†è…èœ"
        
        # 2. è°ƒç”¨å‘é‡æœç´¢
        vector_results = vector_store.search(search_query, n_results=top_k * 2)
        #              â†“
        # è¿›å…¥ vector_store.py

vector_store.py:
    def search(self, query: str, n_results: int):
        # 2.1 ç”ŸæˆæŸ¥è¯¢å‘é‡
        query_embedding = embedding_service.embed_text(query)
        #              â†“
        # è¿›å…¥ embedding_service.py

embedding_service.py:
    def embed_text(self, text: str):
        # åŠ è½½æ¨¡å‹ (é¦–æ¬¡è¿è¡Œæ—¶)
        model = SentenceTransformer("paraphrase-multilingual-MiniLM-L12-v2")
        
        # ç”Ÿæˆå‘é‡
        embedding = model.encode(text, convert_to_numpy=True)
        
        return embedding.tolist()  # [0.23, -0.56, 0.89, ...]

# å›åˆ° vector_store.py
    def search(self, query: str, n_results: int):
        # 2.2 æ‰§è¡Œå‘é‡æœç´¢
        results = self.collection.query(
            query_embeddings=[query_embedding],
            n_results=n_results,
            include=["metadatas", "documents", "distances"]
        )
        
        # 2.3 æ ¼å¼åŒ–ç»“æœ
        formatted_results = []
        for i, recipe_id in enumerate(results['ids'][0]):
            distance = results['distances'][0][i]
            similarity = 1 - distance  # è·ç¦»è½¬ç›¸ä¼¼åº¦
            
            formatted_results.append({
                'id': int(results['metadatas'][0][i]['id']),
                'name': results['metadatas'][0][i]['name'],
                'similarity': round(similarity, 3)
            })
        
        return formatted_results

# å›åˆ° langchain_nlp.py
    async def search_recipes_with_rag(self, query, ingredients, restrictions, top_k):
        # 3. è·å–å®Œæ•´èœè°±ä¿¡æ¯
        enriched_results = []
        for vr in vector_results:
            full_recipe = recipe_service.get_recipe_by_id(vr['id'])
            
            # 4. æ£€æŸ¥é¥®é£Ÿé™åˆ¶
            if restrictions and self._check_restrictions(full_recipe, restrictions):
                continue  # è·³è¿‡ä¸ç¬¦åˆçš„èœè°±
            
            enriched_results.append({
                "recipe": full_recipe,
                "match_score": vr['similarity'],
                "matched_ingredients": [],
                "missing_ingredients": []
            })
        
        # 5. æ’åºå¹¶è¿”å› Top K
        enriched_results.sort(key=lambda x: x['match_score'], reverse=True)
        return enriched_results[:top_k]
```

### è°ƒç”¨é“¾ 3ï¼šå›å¤ç”Ÿæˆï¼ˆLangChainï¼‰

```python
# è°ƒç”¨å…¥å£
chat.py:
    ai_response = await langchain_nlp_service.generate_response(
        user_message="æˆ‘æƒ³åƒæ¸…æ·¡çš„è±†è…èœ",
        history=context,
        recipes=rag_results
    )

# å†…éƒ¨è°ƒç”¨
langchain_nlp.py:
    async def generate_response(self, user_message, history, recipes):
        # 1. æ ¼å¼åŒ–å†å²å¯¹è¯
        history_text = ""
        for msg in history[-5:]:
            if msg['role'] == 'user':
                history_text += f"ç”¨æˆ·: {msg['content']}\n"
            else:
                history_text += f"åŠ©æ‰‹: {msg['content']}\n"
        
        # 2. æ·»åŠ èœè°±ä¿¡æ¯
        input_text = user_message
        if recipes:
            input_text += "\n\nç›¸å…³èœè°±ä¿¡æ¯ï¼š\n"
            for i, r in enumerate(recipes[:3], 1):
                recipe = r['recipe']
                input_text += f"{i}. {recipe.name}...\n"
        
        # 3. ä½¿ç”¨ Response Chain ç”Ÿæˆå›å¤
        response = await self.response_chain.ainvoke({
            "history": history_text,
            "input": input_text
        })
        
        return response

# Response Chain å†…éƒ¨
response_chain = (
    ChatPromptTemplate.from_messages([
        ("system", "ä½ æ˜¯ç¾é£ŸåŠ©æ‰‹..."),
        ("human", "{input}")
    ])
    | self.llm
    | StrOutputParser()
)

# DeepSeek API è°ƒç”¨
POST https://api.deepseek.com/v1/chat/completions
Body:
  {
    "model": "deepseek-chat",
    "messages": [
      {
        "role": "system",
        "content": "ä½ æ˜¯ç¾é£ŸåŠ©æ‰‹ï¼Œè¯·æ ¹æ®ä»¥ä¸‹ä¿¡æ¯å›å¤..."
      },
      {
        "role": "user",
        "content": "æˆ‘æƒ³åƒæ¸…æ·¡çš„è±†è…èœ\n\nç›¸å…³èœè°±ï¼š\n1. é’èœè±†è…æ±¤...\n2. å°è‘±æ‹Œè±†è…..."
      }
    ],
    "temperature": 0.7,
    "max_tokens": 1000
  }
```

---

## ğŸ“ˆ å¤„ç†é¡ºåºæ€»ç»“

### æ—¶é—´çº¿è§†å›¾

```
æ—¶é—´(ms)    0          500         550        600        1400
            â”‚           â”‚           â”‚          â”‚           â”‚
            â–¼           â–¼           â–¼          â–¼           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”¨æˆ·è¾“å…¥: "æˆ‘æƒ³åƒæ¸…æ·¡çš„è±†è…èœ"                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ã€é˜¶æ®µ1ã€‘LangChain æ„å›¾è§£æ                                  â”‚
â”‚                                                              â”‚
â”‚ Intent Chain: PromptTemplate | LLM | Parser                 â”‚
â”‚                                                              â”‚
â”‚ è¾“å‡º: {                                                      â”‚
â”‚   "intent": "recommend",                                     â”‚
â”‚   "preferences": ["æ¸…æ·¡"],                                   â”‚
â”‚   "target_dish": "è±†è…"                                      â”‚
â”‚ }                                                            â”‚
â”‚                                                              â”‚
â”‚ è€—æ—¶: ~500ms (DeepSeek API è°ƒç”¨)                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ã€é˜¶æ®µ2ã€‘RAG å‘é‡æ£€ç´¢                                        â”‚
â”‚                                                              â”‚
â”‚ Step 2.1: Embedding                                        â”‚
â”‚   "æˆ‘æƒ³åƒæ¸…æ·¡çš„è±†è…èœ" â†’ [0.23, -0.56, ...]                 â”‚
â”‚   è€—æ—¶: ~50ms (æœ¬åœ°æ¨¡å‹)                                     â”‚
â”‚                                                              â”‚
â”‚ Step 2.2: Vector Search                                    â”‚
â”‚   ChromaDB.query(embedding)                                â”‚
â”‚   è€—æ—¶: ~20ms                                                â”‚
â”‚                                                              â”‚
â”‚ Step 2.3: è¿‡æ»¤ä¸æ’åº                                        â”‚
â”‚   ç»“æœ: [é’èœè±†è…æ±¤ 0.91, å°è‘±æ‹Œè±†è… 0.88, ...]              â”‚
â”‚   è€—æ—¶: ~10ms                                                â”‚
â”‚                                                              â”‚
â”‚ æ€»è€—æ—¶: ~80ms                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ã€é˜¶æ®µ3ã€‘LangChain å›å¤ç”Ÿæˆ                                  â”‚
â”‚                                                              â”‚
â”‚ Response Chain: ChatPromptTemplate | LLM | Parser           â”‚
â”‚                                                              â”‚
â”‚ è¾“å…¥: ç”¨æˆ·é—®é¢˜ + æ£€ç´¢åˆ°çš„èœè°±                                â”‚
â”‚ è¾“å‡º: "ä¸ºæ‚¨æ¨èä»¥ä¸‹æ¸…æ·¡çš„è±†è…èœï¼š\n1. é’èœè±†è…æ±¤..."         â”‚
â”‚                                                              â”‚
â”‚ è€—æ—¶: ~800ms (DeepSeek API è°ƒç”¨)                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è¿”å›ç»™å‰ç«¯                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ€»è€—æ—¶: ~1.4s
```

---

## ğŸ¯ å…³é”®ç»“è®º

### 1. å¤„ç†é¡ºåº

```
LangChain (æ„å›¾è§£æ)
    â†“
RAG (å‘é‡æ£€ç´¢)
    â†“
LangChain (å›å¤ç”Ÿæˆ)

LangChain æ˜¯æ€»æŒ‡æŒ¥ï¼ŒRAG æ˜¯æ‰§è¡Œè€…
```

### 2. å„è‡ªèŒè´£

| ç»„ä»¶ | èŒè´£ | è¾“å…¥ | è¾“å‡º |
|------|------|------|------|
| **LangChain Intent** | ç†è§£ç”¨æˆ·æ„å›¾ | "æˆ‘æƒ³åƒæ¸…æ·¡çš„è±†è…èœ" | {intent, preferences, target_dish} |
| **RAG** | æŸ¥æ‰¾ç›¸å…³å†…å®¹ | æŸ¥è¯¢æ–‡æœ¬ | [èœè°±1, èœè°±2, èœè°±3] (æŒ‰ç›¸ä¼¼åº¦æ’åº) |
| **LangChain Response** | ç”Ÿæˆå‹å¥½å›å¤ | ç”¨æˆ·é—®é¢˜ + æ£€ç´¢ç»“æœ | "ä¸ºæ‚¨æ¨è..." |

### 3. è°ƒç”¨å…³ç³»

```
LangChain Intent Chain
    â†“ è°ƒç”¨
Embedding Service (å‘é‡åŒ–)
    â†“ è°ƒç”¨
Vector Store (ChromaDB æœç´¢)
    â†“ è¿”å›ç»“æœ
LangChain Response Chain
```

### 4. ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡ï¼Ÿ

```
LangChain å…ˆå¤„ç†çš„åŸå› ï¼š

1. ã€å¿…é¡»å…ˆç†è§£éœ€æ±‚ã€‘
   å¦‚æœä¸å…ˆåšæ„å›¾è§£æï¼Œä¸çŸ¥é“ç”¨æˆ·æƒ³è¦ä»€ä¹ˆ
   RAG æ£€ç´¢å°±æ²¡æœ‰æ–¹å‘

2. ã€æŒ‡å¯¼æ£€ç´¢æ–¹å‘ã€‘
   Intent ç»“æœ: {preferences: ["æ¸…æ·¡"], target_dish: "è±†è…"}
   â†“
   RAG å°±çŸ¥é“è¦æ‰¾ï¼šæ¸…æ·¡çš„ã€è±†è…ç›¸å…³çš„èœ

3. ã€æä¾›ä¸Šä¸‹æ–‡ã€‘
   LangChain Memory ä¿å­˜å¯¹è¯å†å²
   RAG å¯ä»¥åŸºäºä¸Šä¸‹æ–‡åšæ›´ç²¾å‡†çš„æ£€ç´¢

4. ã€ç”Ÿæˆè‡ªç„¶å›å¤ã€‘
   RAG åªè¿”å›åŸå§‹æ•°æ®
   LangChain è´Ÿè´£åŒ…è£…æˆå‹å¥½çš„æ–‡æ¡ˆ
```

---

## ğŸ’¡ ç±»æ¯”ç†è§£

### é¤å…ç‚¹é¤åœºæ™¯

```
é¡¾å®¢ï¼š"æˆ‘æƒ³åƒæ¸…æ·¡çš„è±†è…èœ"

ã€LangChain æ„å›¾è§£æã€‘= æœåŠ¡å‘˜ç†è§£éœ€æ±‚
- å¬æ‡‚äº†ï¼šæƒ³è¦æ¸…æ·¡å£å‘³
- å¬æ‡‚äº†ï¼šæƒ³è¦è±†è…ç›¸å…³
- å¬æ‡‚äº†ï¼šæ˜¯ä¸ªèœå“æ¨èéœ€æ±‚

ã€RAG å‘é‡æ£€ç´¢ã€‘= å¨å¸ˆå»ä»“åº“æ‰¾é£Ÿæ
- æ ¹æ®"æ¸…æ·¡"ã€"è±†è…"å…³é”®è¯
- åœ¨é£Ÿæåº“ä¸­æœç´¢åŒ¹é…çš„èœå“
- æ‰¾åˆ°ï¼šé’èœè±†è…æ±¤ã€å°è‘±æ‹Œè±†è…ã€è’œè“‰è¥¿å…°èŠ±
- æŒ‰æ–°é²œåº¦æ’åº

ã€LangChain å›å¤ç”Ÿæˆã€‘= æœåŠ¡å‘˜ä»‹ç»èœå“
- "ä¸ºæ‚¨æ¨èä»¥ä¸‹æ¸…æ·¡çš„è±†è…èœï¼š"
- "1. é’èœè±†è…æ±¤ï¼Œæ¸…çˆ½å¯å£..."
- "2. å°è‘±æ‹Œè±†è…ï¼Œç®€å•ç¾å‘³..."
```

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**åˆ›å»ºæ—¶é—´**: 2024-01-15  
**æ ¸å¿ƒè¦ç‚¹**: LangChain å…ˆç†è§£ï¼ŒRAG åæ£€ç´¢ï¼ŒLangChain å†ç”Ÿæˆ