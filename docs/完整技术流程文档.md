# ç¾é£Ÿæ¨èç³»ç»Ÿ - å®Œæ•´æŠ€æœ¯æµç¨‹æ–‡æ¡£

## ğŸ“‹ æ–‡æ¡£æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†æè¿°ç”¨æˆ·è¾“å…¥"æˆ‘æœ‰é¸¡è›‹ç•ªèŒ„"åï¼Œç³»ç»Ÿçš„å®Œæ•´å¤„ç†æµç¨‹ã€å‡½æ•°è°ƒç”¨é“¾å’Œæ¨èç®—æ³•é€»è¾‘ã€‚

---

## ğŸ¯ åœºæ™¯ï¼šç”¨æˆ·è¾“å…¥ "æˆ‘æœ‰é¸¡è›‹ç•ªèŒ„"

---

## ç¬¬ä¸€é˜¶æ®µï¼šå‰ç«¯å¤„ç†å±‚

### 1.1 ç”¨æˆ·ç•Œé¢è¾“å…¥

**ä½ç½®**: `frontend/src/components/Chat/ChatInterface.tsx`

```typescript
// ç”¨æˆ·è¾“å…¥
const [input, setInput] = useState('');
const message = "æˆ‘æœ‰é¸¡è›‹ç•ªèŒ„";

// æäº¤è¡¨å•
const handleSubmit = (e: React.FormEvent) => {
    e.preventDefault();
    if (input.trim() && !isLoading) {
        onSendMessage(input);  // è°ƒç”¨çˆ¶ç»„ä»¶çš„ sendMessage
        setInput('');
    }
};
```

**å‡½æ•°è°ƒç”¨**: `onSendMessage(message)` â†’ `App.tsx`

---

### 1.2 App ç»„ä»¶å¤„ç†

**ä½ç½®**: `frontend/src/App.tsx`

```typescript
const handleSendMessage = async (message: string) => {
    // 1. æ·»åŠ ç”¨æˆ·æ¶ˆæ¯åˆ°ç•Œé¢
    setMessages((prev) => [...prev, { role: 'user', content: message }]);
    setIsLoading(true);

    try {
        // 2. è°ƒç”¨ API æœåŠ¡
        const response = await chatApi.sendMessage(message, conversationId);
        
        // 3. æ·»åŠ åŠ©æ‰‹å›å¤åˆ°ç•Œé¢
        setMessages((prev) => [
            ...prev,
            { role: 'assistant', content: response.message },
        ]);
        
        // 4. æ›´æ–°æ¨èèœè°±æ˜¾ç¤º
        setCurrentResponse(response);
    } catch (error) {
        console.error('Error:', error);
    }
};
```

**å‡½æ•°è°ƒç”¨**: `chatApi.sendMessage()` â†’ `api.ts`

---

### 1.3 API æœåŠ¡è°ƒç”¨

**ä½ç½®**: `frontend/src/services/api.ts`

```typescript
export const chatApi = {
    sendMessage: async (message: string, conversationId?: string) => {
        const response = await axios.post(`${API_BASE}/chat/message`, {
            message,           // "æˆ‘æœ‰é¸¡è›‹ç•ªèŒ„"
            conversation_id: conversationId,
        });
        return response.data;  // è¿”å› ChatResponse
    }
};
```

**HTTP è¯·æ±‚**: `POST http://localhost:8080/api/chat/message`

**è¯·æ±‚ä½“**:
```json
{
  "message": "æˆ‘æœ‰é¸¡è›‹ç•ªèŒ„",
  "conversation_id": "a40c3af9-7d80-41da-bc8a-7aae2a9d5705"
}
```

---

## ç¬¬äºŒé˜¶æ®µï¼šåç«¯è·¯ç”±å±‚

### 2.1 FastAPI è·¯ç”±æ¥æ”¶

**ä½ç½®**: `backend/app/routers/chat.py`

```python
@router.post("/message", response_model=ChatResponse)
async def chat_message(request: ChatRequest):
    """
    å¤„ç†ç”¨æˆ·å¯¹è¯æ¶ˆæ¯
    """
    try:
        # Step 1: è·å–æˆ–åˆ›å»ºå¯¹è¯ID
        conversation_id = request.conversation_id
        if not conversation_id:
            conversation_id = conversation_manager.create_conversation()
        
        # Step 2: è·å–å¯¹è¯ä¸Šä¸‹æ–‡
        context = conversation_manager.get_recent_context(conversation_id)
        
        # Step 3: ã€æ ¸å¿ƒã€‘è§£æç”¨æˆ·æ„å›¾
        parsed_intent = await nlp_service.parse_user_intent(request.message)
        
        # ... åç»­å¤„ç†
        
    except Exception as e:
        print(f"Error in chat: {e}")
        raise HTTPException(status_code=500, detail=str(e))
```

**å‡½æ•°è°ƒç”¨é“¾**:
```
chat_message()
    â”œâ”€â”€ conversation_manager.create_conversation()
    â”œâ”€â”€ conversation_manager.get_recent_context()
    â””â”€â”€ nlp_service.parse_user_intent()  ã€è¿›å…¥ NLP æœåŠ¡ã€‘
```

---

## ç¬¬ä¸‰é˜¶æ®µï¼šNLP æ„å›¾è§£æå±‚

### 3.1 æ„å›¾è§£ææœåŠ¡

**ä½ç½®**: `backend/app/services/nlp_service.py`

```python
async def parse_user_intent(self, message: str) -> Dict[str, Any]:
    """
    è§£æç”¨æˆ·æ„å›¾ï¼Œæå–å…³é”®ä¿¡æ¯
    """
    system_prompt = """ä½ æ˜¯ä¸“ä¸šçš„ç¾é£ŸåŠ©æ‰‹...
    æå–: intent, ingredients, restrictions, preferences, target_dish
    """
    
    messages = [
        {"role": "system", "content": system_prompt},
        {"role": "user", "content": message}  # "æˆ‘æœ‰é¸¡è›‹ç•ªèŒ„"
    ]
    
    # è°ƒç”¨ DeepSeek API
    response = await client.post(
        f"{self.api_base}/chat/completions",
        headers={"Authorization": f"Bearer {self.api_key}"},
        json={
            "model": "deepseek-chat",
            "messages": messages,
            "temperature": 0.3,
        }
    )
    
    # è§£æè¿”å›çš„ JSON
    result = response.json()
    content = result["choices"][0]["message"]["content"]
    parsed = json.loads(content)
    
    return parsed
```

**DeepSeek API è°ƒç”¨å‚æ•°**:
```json
{
  "model": "deepseek-chat",
  "messages": [
    {"role": "system", "content": "æå–é£Ÿæã€é™åˆ¶ã€æ„å›¾..."},
    {"role": "user", "content": "æˆ‘æœ‰é¸¡è›‹ç•ªèŒ„"}
  ],
  "temperature": 0.3,
  "max_tokens": 500
}
```

**é¢„æœŸè¿”å›**:
```json
{
  "intent": "recommend_by_ingredients",
  "ingredients": ["é¸¡è›‹", "ç•ªèŒ„"],
  "restrictions": [],
  "preferences": [],
  "target_dish": "",
  "question_type": "recipe_recommendation"
}
```

**å¤±è´¥æ—¶**: ä½¿ç”¨ `_fallback_parse()` è¿›è¡Œå…³é”®è¯åŒ¹é…

---

## ç¬¬å››é˜¶æ®µï¼šèœè°±åŒ¹é…å¼•æ“ï¼ˆæ ¸å¿ƒç®—æ³•ï¼‰

### 4.1 èœè°±åŒ¹é…æœåŠ¡

**ä½ç½®**: `backend/app/services/recipe_matcher.py`

```python
def search_by_ingredients(
    self, 
    ingredients: List[str],      # ["é¸¡è›‹", "ç•ªèŒ„"]
    restrictions: List[str] = None,
    top_k: int = 5
) -> List[Dict]:
    """
    ã€æ ¸å¿ƒç®—æ³•ã€‘åŸºäºé£ŸæåŒ¹é…èœè°±
    
    ç®—æ³•é€»è¾‘:
    1. éå†æ‰€æœ‰èœè°± (50é“)
    2. æ£€æŸ¥é¥®é£Ÿé™åˆ¶
    3. è®¡ç®—é£ŸæåŒ¹é…åˆ†æ•°
    4. æ’åºè¿”å› Top K
    """
    
    results = []
    
    for recipe in self.recipes:  # éå† 50 é“èœè°±
        # Step 1: æ£€æŸ¥é¥®é£Ÿé™åˆ¶
        if self._check_restrictions(recipe, restrictions):
            continue  # è·³è¿‡ä¸ç¬¦åˆçš„èœè°±
        
        # Step 2: è®¡ç®—é£ŸæåŒ¹é…
        recipe_ingredients = [i.name for i in recipe.ingredients]
        
        # ã€å…³é”®ç®—æ³•ã€‘è®¡ç®—äº¤é›†
        matched = set(ingredients) & set(recipe_ingredients)
        # ç¤ºä¾‹: {"é¸¡è›‹", "ç•ªèŒ„"} âˆ© {"é¸¡è›‹", "ç•ªèŒ„", "å¤§è‘±"} = {"é¸¡è›‹", "ç•ªèŒ„"}
        
        if len(matched) > 0:
            # ã€æ ¸å¿ƒå…¬å¼ã€‘åŒ¹é…åˆ†æ•°è®¡ç®—
            score = len(matched) / len(recipe_ingredients)
            # ç¤ºä¾‹: 2/4 = 0.5 (50%)
            
            results.append({
                "recipe": recipe,
                "match_score": score,
                "matched_ingredients": list(matched),
                "missing_ingredients": list(set(recipe_ingredients) - matched)
            })
    
    # Step 3: æ’åº (æŒ‰åŒ¹é…åˆ†æ•°é™åº)
    results.sort(key=lambda x: x["match_score"], reverse=True)
    
    return results[:top_k]
```

---

### 4.2 æ¨èæ¦‚ç‡è®¡ç®—è¯¦è§£

#### ç®—æ³•å…¬å¼

```
åŒ¹é…åˆ†æ•° = (åŒ¹é…é£Ÿææ•° / èœè°±æ€»é£Ÿææ•°) Ã— 100%
```

#### å…·ä½“ç¤ºä¾‹

**ç”¨æˆ·è¾“å…¥**: "æˆ‘æœ‰é¸¡è›‹ç•ªèŒ„"
**ç”¨æˆ·é£Ÿæ**: {é¸¡è›‹, ç•ªèŒ„}

##### èœè°± 1: ç•ªèŒ„ç‚’è›‹
- **æ‰€éœ€é£Ÿæ**: {é¸¡è›‹, ç•ªèŒ„, å¤§è‘±, é£Ÿç”¨æ²¹, ç›, ç™½ç³–} = 6ç§
- **åŒ¹é…é£Ÿæ**: {é¸¡è›‹, ç•ªèŒ„} = 2ç§
- **åŒ¹é…åˆ†æ•°**: 2/6 = 0.333 = **33.3%**

```python
{
    "recipe": <ç•ªèŒ„ç‚’è›‹å¯¹è±¡>,
    "match_score": 0.333,
    "matched_ingredients": ["é¸¡è›‹", "ç•ªèŒ„"],
    "missing_ingredients": ["å¤§è‘±", "é£Ÿç”¨æ²¹", "ç›", "ç™½ç³–"]
}
```

##### èœè°± 2: è¥¿çº¢æŸ¿é¸¡è›‹æ±¤
- **æ‰€éœ€é£Ÿæ**: {é¸¡è›‹, ç•ªèŒ„, è‘±èŠ±, é¦™æ²¹, ç›, æ°´æ·€ç²‰, æ¸…æ°´} = 7ç§
- **åŒ¹é…é£Ÿæ**: {é¸¡è›‹, ç•ªèŒ„} = 2ç§
- **åŒ¹é…åˆ†æ•°**: 2/7 = 0.286 = **28.6%**

##### èœè°± 3: éŸ­èœç‚’è›‹
- **æ‰€éœ€é£Ÿæ**: {é¸¡è›‹, éŸ­èœ, é£Ÿç”¨æ²¹, ç›} = 4ç§
- **åŒ¹é…é£Ÿæ**: {é¸¡è›‹} = 1ç§
- **åŒ¹é…åˆ†æ•°**: 1/4 = 0.25 = **25%**

#### æ’åºç»“æœ

```
1. ç•ªèŒ„ç‚’è›‹      - 33.3% âœ…
2. è¥¿çº¢æŸ¿é¸¡è›‹æ±¤  - 28.6%
3. éŸ­èœç‚’è›‹      - 25%
```

---

### 4.3 é¥®é£Ÿé™åˆ¶è¿‡æ»¤

```python
def _check_restrictions(self, recipe: Recipe, restrictions: List[str]) -> bool:
    """
    æ£€æŸ¥èœè°±æ˜¯å¦è¿åé¥®é£Ÿé™åˆ¶
    
    é™åˆ¶æ˜ å°„:
    - ç´ é£Ÿ â†’ æ’é™¤è‚‰ç±»ã€æ°´äº§
    - æ— æµ·é²œ â†’ æ’é™¤æ°´äº§
    - æ— è¾£ â†’ æ’é™¤è¾£æ ‡ç­¾
    - ä½ç¢³æ°´ â†’ æ’é™¤ä¸»é£Ÿ
    """
    restriction_keywords = {
        "ç´ é£Ÿ": ["è‚‰ç±»", "æ°´äº§"],
        "çº¯ç´ ": ["è‚‰ç±»", "æ°´äº§", "è›‹å¥¶"],
        "æ— æµ·é²œ": ["æ°´äº§"],
        "æ— è¾£": ["è¾£"],
    }
    
    for restriction in restrictions:
        if restriction in restriction_keywords:
            banned_categories = restriction_keywords[restriction]
            
            # æ£€æŸ¥é£Ÿæåˆ†ç±»
            for ingredient in recipe.ingredients:
                if ingredient.category in banned_categories:
                    return True  # è¿åé™åˆ¶
                    
            # æ£€æŸ¥æ ‡ç­¾
            for category in banned_categories:
                if category in recipe.tags:
                    return True
                    
    return False  # ç¬¦åˆè¦æ±‚
```

---

## ç¬¬äº”é˜¶æ®µï¼šAI å›å¤ç”Ÿæˆ

### 5.1 å›å¤ç”ŸæˆæœåŠ¡

**ä½ç½®**: `backend/app/services/nlp_service.py`

```python
async def generate_response(
    self, 
    user_message: str,           # "æˆ‘æœ‰é¸¡è›‹ç•ªèŒ„"
    context: List[Dict],         # å†å²å¯¹è¯
    recipes: List[Dict] = None   # åŒ¹é…çš„èœè°±
) -> str:
    """
    ç”Ÿæˆå¯¹è¯å›å¤
    """
    
    # æ„å»ºç³»ç»Ÿæç¤ºè¯
    system_prompt = """ä½ æ˜¯ç¾é£Ÿæ¨èåŠ©æ‰‹...
    æ ¹æ®ç”¨æˆ·é£Ÿææ¨èèœè°±ï¼Œè¯¦ç»†è§£é‡Šçƒ¹é¥ªæ­¥éª¤
    """
    
    # æ„å»ºæ¶ˆæ¯å†å²
    messages = [{"role": "system", "content": system_prompt}]
    
    # æ·»åŠ ä¸Šä¸‹æ–‡ï¼ˆæœ€è¿‘5è½®ï¼‰
    for msg in context[-5:]:
        messages.append(msg)
    
    # æ·»åŠ èœè°±ä¿¡æ¯
    if recipes:
        recipe_info = "\n\nç›¸å…³èœè°±ï¼š\n"
        for r in recipes:
            recipe = r["recipe"]
            recipe_info += f"- {recipe.name}..."
        user_message += recipe_info
    
    messages.append({"role": "user", "content": user_message})
    
    # è°ƒç”¨ DeepSeek ç”Ÿæˆå›å¤
    response = await client.post(...)
    
    return response["choices"][0]["message"]["content"]
```

**ç”Ÿæˆçš„å›å¤ç¤ºä¾‹**:
```
å—¨ï¼çœ‹åˆ°ä½ æ‰‹å¤´æœ‰é¸¡è›‹å’Œç•ªèŒ„ï¼Œè¿™å¯æ˜¯å¨æˆ¿é‡Œçš„é»„é‡‘æ­æ¡£å‘¢ï¼ğŸ…ğŸ¥š

## ğŸ³ ä»Šæ—¥æ¨è

### 1. **ç•ªèŒ„ç‚’è›‹** â­ æœ€ç»å…¸
- **åŒ¹é…åº¦**: 33%
- **éš¾åº¦**: ç®€å• â± 10åˆ†é’Ÿ
- **å·²æœ‰é£Ÿæ**: é¸¡è›‹âœ“ã€ç•ªèŒ„âœ“
- **è¿˜éœ€**: å¤§è‘±ã€é£Ÿç”¨æ²¹ã€ç›ã€ç™½ç³–

### 2. **è¥¿çº¢æŸ¿é¸¡è›‹æ±¤** ğŸ²
- **åŒ¹é…åº¦**: 29%
- **éš¾åº¦**: ç®€å• â± 15åˆ†é’Ÿ
...

éœ€è¦æˆ‘è¯¦ç»†è®²è§£ç•ªèŒ„ç‚’è›‹çš„åšæ³•å—ï¼Ÿ
```

---

## ç¬¬å…­é˜¶æ®µï¼šå¯¹è¯ä¸Šä¸‹æ–‡ç®¡ç†

### 6.1 ä¿å­˜å¯¹è¯å†å²

**ä½ç½®**: `backend/app/services/conversation.py`

```python
def add_message(
    self, 
    conversation_id: str,
    role: str,                    # "user" æˆ– "assistant"
    content: str,
    ingredients: List[str] = None,
    restrictions: List[str] = None
):
    """
    æ·»åŠ æ¶ˆæ¯åˆ°å¯¹è¯ä¸Šä¸‹æ–‡
    """
    conversation = self.conversations[conversation_id]
    
    # åˆ›å»ºæ¶ˆæ¯å¯¹è±¡
    message = ChatMessage(
        role=role,
        content=content,
        timestamp=datetime.now()
    )
    
    # æ·»åŠ åˆ°æ¶ˆæ¯åˆ—è¡¨
    conversation.messages.append(message)
    conversation.updated_at = datetime.now()
    
    # æ›´æ–°è¯†åˆ«çš„ä¿¡æ¯
    if ingredients:
        conversation.detected_ingredients.extend(ingredients)
        # å»é‡
        conversation.detected_ingredients = list(set(conversation.detected_ingredients))
    
    if restrictions:
        conversation.detected_restrictions.extend(restrictions)
        conversation.detected_restrictions = list(set(conversation.detected_restrictions))
```

**å¯¹è¯çŠ¶æ€**:
```python
{
    "conversation_id": "a40c3af9-7d80-41da-bc8a-7aae2a9d5705",
    "messages": [
        {"role": "user", "content": "æˆ‘æœ‰é¸¡è›‹ç•ªèŒ„", "timestamp": "2024-01-15T10:30:00"},
        {"role": "assistant", "content": "å—¨ï¼çœ‹åˆ°ä½ æ‰‹å¤´æœ‰...", "timestamp": "2024-01-15T10:30:05"}
    ],
    "detected_ingredients": ["é¸¡è›‹", "ç•ªèŒ„"],
    "detected_restrictions": [],
    "user_preferences": {}
}
```

---

## ç¬¬ä¸ƒé˜¶æ®µï¼šå“åº”ç»„è£…ä¸è¿”å›

### 7.1 ç»„è£… ChatResponse

**ä½ç½®**: `backend/app/routers/chat.py`

```python
return ChatResponse(
    message=ai_response,              # AI ç”Ÿæˆçš„å›å¤æ–‡æœ¬
    conversation_id=conversation_id,   # å¯¹è¯ID
    suggested_recipes=[                # æ¨èçš„èœè°±åˆ—è¡¨
        {
            "recipe": {
                "id": 1,
                "name": "ç•ªèŒ„ç‚’è›‹",
                "name_en": "Tomato and Egg Stir-fry",
                "category": "å®¶å¸¸èœ",
                "difficulty": "ç®€å•",
                "time": "10åˆ†é’Ÿ",
                "servings": 2,
                "nutrition": {
                    "calories": 180,
                    "protein": 12.0,
                    "fat": 11.0,
                    "carbs": 8.0,
                    "fiber": 2.0
                },
                "tags": ["ç´ é£Ÿ", "å¿«æ‰‹èœ", "é«˜è›‹ç™½"],
                "steps": [...],
                "tips": [...]
            },
            "match_score": 0.333,
            "matched_ingredients": ["é¸¡è›‹", "ç•ªèŒ„"],
            "missing_ingredients": ["å¤§è‘±", "é£Ÿç”¨æ²¹", "ç›", "ç™½ç³–"]
        },
        # ... å…¶ä»–èœè°±
    ],
    detected_ingredients=["é¸¡è›‹", "ç•ªèŒ„"],
    detected_restrictions=[],
    nutrition_info=None
)
```

---

## ç¬¬å…«é˜¶æ®µï¼šå‰ç«¯å±•ç¤º

### 8.1 æ¥æ”¶å“åº”å¹¶å±•ç¤º

**ä½ç½®**: `frontend/src/App.tsx`

```typescript
// æ¥æ”¶å“åº”
const response = await chatApi.sendMessage(message, conversationId);

// æ›´æ–°çŠ¶æ€
setMessages((prev) => [
    ...prev,
    { role: 'assistant', content: response.message },
]);

setCurrentResponse(response);
```

### 8.2 èœè°±å¡ç‰‡å±•ç¤º

**ä½ç½®**: `frontend/src/components/RecipeCard/RecipeCard.tsx`

```typescript
// è§£æ„å“åº”æ•°æ®
const { recipe, match_score, matched_ingredients, missing_ingredients } = match;

// å±•ç¤º
<h4>{recipe.name}</h4>                    // ç•ªèŒ„ç‚’è›‹
<div>{Math.round(match_score * 100)}%</div>  // 33%
<div>å·²æœ‰: {matched_ingredients.join('ã€')}</div>  // é¸¡è›‹ã€ç•ªèŒ„
<div>è¿˜éœ€: {missing_ingredients.join('ã€')}</div>  // å¤§è‘±ã€é£Ÿç”¨æ²¹...
```

---

## å®Œæ•´è°ƒç”¨é“¾æ€»ç»“

```
ç”¨æˆ·è¾“å…¥: "æˆ‘æœ‰é¸¡è›‹ç•ªèŒ„"
    â†“
ã€å‰ç«¯å±‚ã€‘
ChatInterface.tsx â†’ onSendMessage()
    â†“
App.tsx â†’ handleSendMessage()
    â†“
api.ts â†’ chatApi.sendMessage()
    â†“
HTTP POST /api/chat/message
    â†“
ã€åç«¯å±‚ã€‘
chat.py â†’ chat_message()
    â”œâ”€â”€ conversation_manager.create_conversation()
    â”œâ”€â”€ conversation_manager.get_recent_context()
    â”œâ”€â”€ nlp_service.parse_user_intent()      â†’ DeepSeek API
    â”‚       â””â”€â”€ è¿”å›: {ingredients: ["é¸¡è›‹", "ç•ªèŒ„"], intent: "recommend"}
    â”‚
    â”œâ”€â”€ recipe_service.search_by_ingredients()  ã€æ ¸å¿ƒç®—æ³•ã€‘
    â”‚       â”œâ”€â”€ éå† 50 é“èœè°±
    â”‚       â”œâ”€â”€ _check_restrictions()          æ£€æŸ¥é™åˆ¶
    â”‚       â”œâ”€â”€ è®¡ç®— matched = set(user) âˆ© set(recipe)
    â”‚       â”œâ”€â”€ è®¡ç®— score = len(matched) / len(recipe_ingredients)
    â”‚       â””â”€â”€ æ’åºè¿”å› Top 3
    â”‚
    â”œâ”€â”€ nlp_service.generate_response()        â†’ DeepSeek API
    â”‚       â””â”€â”€ ç”Ÿæˆå‹å¥½å›å¤
    â”‚
    â”œâ”€â”€ conversation_manager.add_message()     ä¿å­˜å¯¹è¯
    â”‚
    â””â”€â”€ ç»„è£… ChatResponse
    â†“
JSON å“åº”
    â†“
ã€å‰ç«¯å±‚ã€‘
App.tsx æ¥æ”¶å“åº”
    â†“
æ›´æ–° messages çŠ¶æ€ â†’ æ˜¾ç¤º AI å›å¤
æ›´æ–° currentResponse â†’ æ¸²æŸ“ RecipeCard
    â†“
ç”¨æˆ·çœ‹åˆ°: æ¨èèœè°±åˆ—è¡¨ + è¯¦ç»†è¯´æ˜
```

---

## æ¨èç®—æ³•å¯è§†åŒ–

```
ç”¨æˆ·é£Ÿæ: [é¸¡è›‹, ç•ªèŒ„]

èœè°±æ•°æ®åº“ (50é“):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç•ªèŒ„ç‚’è›‹ (6ç§é£Ÿæ)                                â”‚
â”‚   æ‰€éœ€: [é¸¡è›‹, ç•ªèŒ„, å¤§è‘±, é£Ÿç”¨æ²¹, ç›, ç™½ç³–]       â”‚
â”‚   åŒ¹é…: [é¸¡è›‹, ç•ªèŒ„] = 2ç§                        â”‚
â”‚   åˆ†æ•°: 2/6 = 33.3% â­ ç¬¬1å                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è¥¿çº¢æŸ¿é¸¡è›‹æ±¤ (7ç§é£Ÿæ)                            â”‚
â”‚   æ‰€éœ€: [é¸¡è›‹, ç•ªèŒ„, è‘±èŠ±, é¦™æ²¹, ç›, æ°´æ·€ç²‰, æ¸…æ°´] â”‚
â”‚   åŒ¹é…: [é¸¡è›‹, ç•ªèŒ„] = 2ç§                        â”‚
â”‚   åˆ†æ•°: 2/7 = 28.6%  ç¬¬2å                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ éŸ­èœç‚’è›‹ (4ç§é£Ÿæ)                                â”‚
â”‚   æ‰€éœ€: [é¸¡è›‹, éŸ­èœ, é£Ÿç”¨æ²¹, ç›]                   â”‚
â”‚   åŒ¹é…: [é¸¡è›‹] = 1ç§                              â”‚
â”‚   åˆ†æ•°: 1/4 = 25%    ç¬¬3å                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ’åº: æŒ‰ match_score é™åº
è¿”å›: Top 3
```

---

## æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | æ•°å€¼ | è¯´æ˜ |
|------|------|------|
| **æ„å›¾è§£æ** | ~500ms | DeepSeek API è°ƒç”¨ |
| **èœè°±åŒ¹é…** | ~10ms | æœ¬åœ°è®¡ç®—ï¼Œ50é“èœ |
| **å›å¤ç”Ÿæˆ** | ~800ms | DeepSeek API è°ƒç”¨ |
| **æ€»å“åº”æ—¶é—´** | ~1.5s | ç«¯åˆ°ç«¯ |
| **åŒ¹é…å‡†ç¡®ç‡** | ~85% | åŸºäºäº¤é›†ç®—æ³• |
| **æ”¯æŒèœè°±æ•°** | 50é“ | å¯æ‰©å±•è‡³ 5000+ |

---

## å…³é”®ä»£ç æ–‡ä»¶æ¸…å•

| æ–‡ä»¶è·¯å¾„ | åŠŸèƒ½ |
|---------|------|
| `frontend/src/components/Chat/ChatInterface.tsx` | å‰ç«¯è¾“å…¥ç»„ä»¶ |
| `frontend/src/App.tsx` | å‰ç«¯ä¸»é€»è¾‘ |
| `frontend/src/services/api.ts` | API è°ƒç”¨æœåŠ¡ |
| `backend/app/routers/chat.py` | åç«¯è·¯ç”±å¤„ç† |
| `backend/app/services/nlp_service.py` | NLP æ„å›¾è§£æ |
| `backend/app/services/recipe_matcher.py` | èœè°±åŒ¹é…ç®—æ³• |
| `backend/app/services/conversation.py` | å¯¹è¯ä¸Šä¸‹æ–‡ç®¡ç† |
| `backend/app/data/recipes.json` | èœè°±æ•°æ® |

---

## æ‰©å±•ï¼šRAG è¯­ä¹‰æœç´¢æµç¨‹

å¦‚æœä½¿ç”¨ LangChain + RAGï¼ˆä»£ç å·²æä¾›ï¼‰ï¼š

```
ç”¨æˆ·è¾“å…¥: "æ¸…æ·¡çš„è±†è…èœ"
    â†“
embedding_service.embed_text()  â†’ å‘é‡ [0.23, -0.56, ...]
    â†“
vector_store.search()           â†’ è¯­ä¹‰ç›¸ä¼¼åº¦æœç´¢
    â†“
ChromaDB è¿”å›:
  1. é’èœè±†è…æ±¤ - ç›¸ä¼¼åº¦ 0.91
  2. è’œè“‰è¥¿å…°èŠ± - ç›¸ä¼¼åº¦ 0.78
  3. éº»å©†è±†è…   - ç›¸ä¼¼åº¦ 0.45 âŒï¼ˆå¤ªæ²¹è…»ï¼‰
    â†“
æ— éœ€å…³é”®è¯åŒ¹é…ï¼Œç†è§£è¯­ä¹‰ï¼
```

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2024-01-15  
**é€‚ç”¨é¡¹ç›®**: ç¾é£Ÿæ¨èä¸é£Ÿè°±æ™ºèƒ½åŠ©æ‰‹